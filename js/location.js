/*from tccdn minify at 2015-12-31 0:15:44,file：/touch/weixin/train/js/public/location/0.0.1/location.js*/
!function(){function a(a){function b(a){$.ajax({url:"http://api.map.baidu.com/geocoder/v2/?ak=R1BS15aSlKUTpc0YG6GbDk7Q&output=json&pois=0&location="+a.latitude+","+a.longitude,dataType:"jsonp",success:function(b){0===b.status?$.extend(a,b.result.addressComponent,{business:b.result.business,cityCode:b.result.cityCode}):a.tips="获取地址信息失败";try{localStorage.setItem("locationInfo",JSON.stringify(a))}catch(d){}c&&c(a)}})}var e={latitude:a.coords.latitude,longitude:a.coords.longitude};if(d){c&&c(e);try{localStorage.setItem("locationInfo",JSON.stringify(e))}catch(f){}}else $.ajax({url:"http://api.map.baidu.com/geoconv/v1/?ak=R1BS15aSlKUTpc0YG6GbDk7Q&from=1&to=5&output=json&coords="+e.longitude+","+e.latitude,dataType:"jsonp",success:function(a){b(0===a.status?{longitude:a.result[0].x,latitude:a.result[0].y}:e)}})}function b(a){var b={};switch(a.code){case a.PERMISSION_DENIED:b.tips="用户拒绝获取地理位置",b.reject=!0;break;case a.POSITION_UNAVAILABLE:b.tips="位置信息不可用";break;case a.TIMEOUT:b.tips="获取用户位置请求超时";break;case a.UNKNOWN_ERROR:b.tips="获取位置失败，请重试"}c&&c(b)}var c,d;if(navigator.geolocation)$.location=function(e,f,g){c=e,"object"==typeof f&&(g=f,f=void 0);var h=$.extend({enableHighAccuracy:!0,maximumAge:3e4,timeout:12e3},g);d=f,navigator.geolocation.getCurrentPosition(a,b,h)};else{var e={tips:"浏览器不支持定位"};$.location=function(a){a(e)}}$.historyLocation=function(){try{return localStorage.getItem("locationInfo")}catch(a){}},$.locationByIp=function(a){$.ajax({url:"http://m.ly.com/ajax/GetCityByIp.ashx",dataType:"jsonp",timeout:1e4,success:function(b){var c={};if(b){c={province:b.ProvinceName,provinceCode:b.ProvinceID,city:b.CityName,cityCode:b.CityID};try{localStorage.setItem("locationInfo",JSON.stringify(c))}catch(d){}}else c={tips:"获取地址信息失败"};a&&a(c)},error:function(){a&&a({tips:"获取地址信息失败"})}})}}();
