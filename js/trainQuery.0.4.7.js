define("trainQuery.0.4.7",function (require, exports, module) {
	(function(){typeof(Common)!="undefined"&&(Common.initMenu("#footer"),Common.initEntry("submain"));setTimeout(function(){var c=getWxObj().openid,d=getWxObj().userid;if(c&&c!="null"&&c!="0"&&c!=undefined&&c!="undefined"){StorageHelp.SetStorage("WxOpenid",c)}if(!!d&&d!="null"&&d!=undefined&&d!="undefined"&&d!="0"&&d!=""){StorageHelp.SetStorage("WxUserid",d)}else{StorageHelp.SetStorage("WxUserid","")}},2000);b();function b(){if(window.page&&typeof WebConfigUrl!=="undefined"&&$.city&&$.calendar&&typeof mobileUtil!=="undefined"&&typeof StorageHelp!=="undefined"){a()}else{setTimeout(b,500)}}function a(){function l(s){$.ajax({url:"GetServiceTime",dataType:"json",timeout:5000,success:function(t){if(t.ResponseStatus){SERVERTIME=t.ResponseMessage.replace(/-/g,"/")}},complete:function(){if(s){s()}}})}var m={length:10};var c=$("<div id='calContainerPage' class='page'/>");$("body").append(c);function k(){var s=["A","B","C","D","E","F","G","H","J","K","L","M","N","O","P","Q","R","S","T","W","X","Y","Z"];$.city({nameAttr:1,pyAttr:3,matchAttrs:[1,3],dataAttrMap:{id:0,name:1,fullPy:2},cities:{url:"GetCityListByLetter?allCity=0&letter={cityKey}",dataType:"json",success:function(u){var v=[];var w=u.TrainStation.StationList;for(i in w){var t=[];t[0]=w[i].ID;t[1]=w[i].Name;t[2]=w[i].QPY;t[3]=w[i].JPY;v.push(t)}return v}},cityFilter:function(t){return t[2]==="0"},hotCities:{url:"GetHotCityListV1",dataType:"json",success:function(u){var v=[];var w=u.TrainStation.StationList;for(i in w){var t=[];t[0]=w[i].ID;t[1]=w[i].Name;t[2]=w[i].QPY;t[3]=w[i].JPY;v.push(t)}return v}},historyCityName:"traincityHistoryName",historyCityNumber:6,fn:function(t){$("#cityPage").toggle();page.close();$("p.t_incity input",f).val(t[1]);$(".CN",f).val(t[1]);$(".PY",f).val(t[2])},mode:"asRequired",searchObj:{url:"GetCityListByLetter?allCity=0",name:"letter",dataType:"json",processFn:function(u){if(u.TrainStation){document.querySelector(".search-complete").style.display="block";document.querySelector(".city-wrapper").style.display="none";var w=[];var v=u.TrainStation.StationList;for(i in v){var t=[];t[0]=v[i].Name;t[1]=v[i].Name;t[2]=v[i].QPY;t[3]=v[i].JPY;w.push(t)}return w}else{document.querySelector(".search-complete").style.display="none";document.querySelector(".city-wrapper").style.display="block"}}},letters:s,loc:{url:"GetCityListByLetter?allCity=0&letter={cityName}",dataType:"json",success:function(v){var u=[];var w=v.TrainStation.StationList;var t=[];t[0]=w[0].ID;t[1]=w[0].Name;t[2]=w[0].QPY;t[3]=w[0].JPY;u.push(t);return u}},hasLocation:2})}page&&page.init(function(s){if(/^[\w-]*$/.test(s)){return $("#"+s+"Page")}else{return[]}});var f;$("#t_from,#t_to").on("click",function(){page.open("city");$("#cityPage input").attr("onkeydown","if(event.keyCode==32) return false;");k();f=this});var r=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],g=["元宵","清明","端午","中秋","重阳","情人","儿童","国庆","圣诞"],h;$("#BeginTime").click(function(){$("#calContainerPage").find(".calendar").remove();var s=$.calendar({mode:"rangeFrom",startDate:(typeof SERVERTIME!=="undefined")?new Date(SERVERTIME):new Date(),endDate:PolicyDateValidate.getPolicyDepDate()||new Date(Date.parse((typeof SERVERTIME!=="undefined")?new Date(SERVERTIME):new Date())+19*24*60*60*1000),wrapper:$("#calContainerPage"),currentDate:[$("#Time").val()],fn:function(x){var z=x.join("-");x=new Date(x.join("/"));StorageHelp.SetStorage("bDate",x.format("yyyy-MM-dd"));$("#Time").val(x.format("yyyy-MM-dd"));var A=getTimes(z.replace(/-0/g,"-"),1),y="";if(A.indexOf("周")<0){y="&nbsp;&nbsp;"+A}$("#tselect_Date").html('<span class="orange">'+(x.getMonth()+1)+"月"+(x.getDate())+"日</span>&nbsp;<span>&nbsp;"+getTimes(z.replace(/-0/g,"-"),1)+'</span><span class="tra_left wxTrainBg"></span>');page.close()},buildContent:function(A,B,y,z){var C;var D=(typeof SERVERTIME!=="undefined")?new Date(SERVERTIME):new Date();var E=(typeof SERVERTIME!=="undefined")?new Date(SERVERTIME):new Date();var F=new Date(D.setDate(D.getDate()+1));var x=new Date(D.setDate(F.getDate()+1));C=B?B:A.getDate();if(B){if(g.indexOf(B)!==-1){C="<div>"+B+"节</div>"}else{C="<div>"+B+"</div>"}}if(A.format("yyyyMMdd")==F.format("yyyyMMdd")){C="明天"}if(A.format("yyyyMMdd")==x.format("yyyyMMdd")){C="后天"}if(y.toString().indexOf("today")>=0){C=A.getDate()}if(A.format("yyyyMMdd")==E.format("yyyyMMdd")){C="<div class='today'>今天</div>"}if(new Date(A.format("yyyy/MM/dd"))>new Date(this.endDate.format("yyyy/MM/dd"))){y.push("area")}return C}});$("#calContainerPage .tip").remove();var w=s.startDate.getMonth()+1,v=s.startDate.getDate(),u=s.endDate.getMonth()+1,t=s.endDate.getDate();$("#calContainerPage").append('<div class="tip"><p>今天是'+w+"月"+v+"号，可购买"+u+"月"+t+"号的火车票</p><p>部分车次预售期特殊，请以车站当日公布的为准</p></div>");$("#calContainerPage .area.disabled[data-day]").on("click",function(){var y=$(this).parents(".calendar-wrapper"),x=y.attr("data-year")+"/"+y.attr("data-month")+"/"+$(this).attr("data-day"),z=new Date(new Date(x).setDate(new Date(x).getDate()-59)).format("yyyy年MM月dd日");mobileUtil.dialog("预售期为60天，您所选日期将在"+z+"开售。","#calContainerPage")});page.open("calContainer")});$("#t_changeCity").on(mobileUtil.start,function(){d()});$("#myTrainOrders").click(function(){if(unLogin()){location.href=WebConfigUrl.MyOrders}});$("#SpecialZone").bind("click",function(){var s=getWxObj().userid;if(s!=""&&s!="0"&&s!=""){location.href="/flight/flightspecialindex.html?bookerId="+s}else{var t=getWxObj().openid;if(t&&(!/undefined/.test(t)||t!="")){t="123"}location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx3827070276e49e30&redirect_uri=http://wx.17u.cn/flight/flightspecialindex.html?showwxpaytitle=1&response_type=code&scope=snsapi_base&state="+t+"#wechat_redirect"}});$("#myhelper2").bind("click",function(){location.href="/flight/myflighthelper.html";var s=getWxObj().userid;if(s!=""&&s!="0"&&typeof(s)!="undefined"){location.href="/flight/myflighthelper.html?bookerId="+s}else{var t=getWxObj().openid;if(t&&(!/undefined/.test(t)||t!="")){t="123"}location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx3827070276e49e30&redirect_uri=http://wx.17u.cn/flight/myflighthelper.html?showwxpaytitle=1&response_type=code&scope=snsapi_base&state="+t+"#wechat_redirect"}});$("#index").bind("click",function(){location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx3827070276e49e30&redirect_uri=http://wx.17u.cn/train/trainquery.html?showwxpaytitle=1&response_type=code&scope=snsapi_base&state="+123+"#wechat_redirect"});$("#myflight").bind("click",function(){location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx3827070276e49e30&redirect_uri=http://wx.17u.cn/flight/myflight.html?showwxpaytitle=1&response_type=code&scope=snsapi_base&state="+123+"#wechat_redirect"});function n(){var s=StorageHelp.GetStorage("City"),t;if(!!s){t=JSON.parse(s);$("#t_from .t_incity input").val(t.bName);$("#t_from .CN").val(t.bName);$("#t_from .PY").val(t.beginCity);$("#t_to .t_incity input").val(t.aName);$("#t_to .CN").val(t.aName);$("#t_to .PY").val(t.arrCity)}}function o(){l(function(){var C=new Date((typeof SERVERTIME!=="undefined")?new Date(SERVERTIME):new Date()),F=C.getFullYear(),x=C.getMonth()+1,u=C.getDate(),E,w,s;x=x<10?"0"+x:x;u=u<10?"0"+u:u;var z=C.getFullYear()+"-"+(C.getMonth()+1)+"-"+C.getDate();var t=StorageHelp.GetStorage("bDate");var B=t?((Date.parse(t.replace(/-/g,"/"))>=Date.parse(z.replace(/-/g,"/")))?t:GetDateStr(1)):GetDateStr(1);var D=getTimes(B.replace(/-0/g,"-"),1),v="";if(D.indexOf("周")<0){v="&nbsp;&nbsp;"+D}var A=B.split("-");E=A[0];w=A[1];s=A[2];$("div#BeginTime input[type=hidden]").val(B);$("#tselect_Date").html('<span class="orange">'+w+"月"+s+"日</span><span>"+v+"&nbsp;&nbsp;"+getTimes(B.replace(/-0/g,"-"),0))})}function p(){var x=StorageHelp.GetStorage("queryhistory"),u="";if(x!=""&&JSON.parse(x).length>0){var t=JSON.parse(x);t.length>5&&(t.length=5);for(var v=0,w=t.length;v<w;v++){u+="<li class='touchablelist' onclick=\"_tcTraObj._tcTrackEvent('click','chaxunlishi','wxtrain','')\"><span py="+t[v].beginCity+">"+t[v].bName+"</span>至<span py="+t[v].arrCity+">"+t[v].aName+"</span></li>"}}if(u==""){$(".linebox").addClass("none")}$("#queryhistory .querybox_cont ul").html(u);$(".querybox_cont li").on("touchstart",function(){var y=this;timer=setTimeout(function(){var z=$.dialog({autoOpen:false,closeBtn:false,width:200,closeTime:1000,maskClick:function(){z.destroy()},content:'<button class="del touchable">删除</button>'});z.open();$(".ui-dialog-content").css({padding:0});$(".ui-dialog .del").on("click",function(){$(y).remove();z.destroy();var A={};A.beginCity=$("span",y).eq(0).attr("py");A.arrCity=$("span",y).eq(1).attr("py");A.bName=$("span",y).eq(0).html();A.aName=$("span",y).eq(1);var B=JSON.parse(StorageHelp.GetStorage("queryhistory"));B.shift(A);StorageHelp.SetStorage("queryhistory",JSON.stringify(B))})},500)}).on("touchmove",function(){clearTimeout(timer)}).on("click",function(){if($(".ui-mask").html()==null){var z=$("span",this).eq(0);var y=$("span",this).eq(1);$("#t_goCity").val(z.html());$("[name='BeginPlaceCn']").val(z.html());$("[name='BeginPlace']").val(z.attr("py"));$("#t_backCity").val(y.html());$("[name='ArrPlaceCn']").val(y.html());$("[name='ArrPlace']").val(y.attr("py"))}}).on("touchend",function(){clearTimeout(timer)});var s=$(window).height()-450;$(".querybox_cont").height(s>24?s:24)}function d(){var s=$("input#t_goCity").val(),t=$("input#t_backCity").val(),u=$("#t_from .PY").val(),v=$("#t_to .PY").val();$("#t_backCity").addClass("flyleft");$("#t_goCity").addClass("flyright");setTimeout(function(){$("#t_backCity").removeClass("flyleft");$("#t_goCity").removeClass("flyright");$("input#t_goCity").val(t);$("#t_backCity").val(s);$("#t_from .PY").val(v);$("#t_from .CN").val(t);$("#t_to .PY").val(u);$("#t_to .CN").val(s)},500)}$("form#t_myform").submit(function(){var v=$("#t_from .PY").val().trim(),s=$("#t_to .PY").val().trim(),y=getWxObj().openid||getCooperateUser().openid,C=getWxObj().token||getCooperateUser().token,w=$("#t_goCity").val().trim(),t=$("#t_backCity").val().trim(),B=$("div#BeginTime input[type=hidden]").val().trim(),u=$(this).attr("aurl");$("input[type=hidden][name='openid']").val(y);$("input[type=hidden][name='token']").val(C);if(v==""||w==""){mobileUtil.dialog("请选择出发城市！","#mainPage");return false}if(s==""||t==""){mobileUtil.dialog("请选择到达城市！","#mainPage");return false}if(B==""){mobileUtil.dialog("请选择出发日期！","#mainPage");return false}if(v==s){mobileUtil.dialog("出发站点不能和到达站点相同！","#mainPage");return false}var x={beginCity:v,arrCity:s,bName:w,aName:t};StorageHelp.SetStorage("City",JSON.stringify(x));StorageHelp.SetStorage("bDate",B);StorageHelp.SetStorage("filter","");u=u.replace("{begincity}",v).replace("{tocity}",s).replace("{time}",B.replace(/-/g,"")).replace("{openid}",y).replace("{token}",C);var A=StorageHelp.GetStorage("queryhistory");if(A==""){A="[]"}var z=JSON.parse(A);z.forEach(function(E,D){if(E.beginCity==x.beginCity&&E.arrCity==x.arrCity){z.splice(D,1)}});z.unshift(x);A=JSON.stringify(z);StorageHelp.SetStorage("queryhistory",A);this.action=WebConfigUrl.wxTrainUrl+"trainsearch.html"});$("#IsFlight").bind("click",function(){$(this).addClass("border_bottom_green");$("#IsTrain").removeClass("border_bottom_green");if(location.href.indexOf("wx.17u.cn/train/")!=-1){location.replace("https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx3827070276e49e30&redirect_uri=http://wx.17u.cn/flight/index.html&response_type=code&scope=snsapi_base&state=123&connect_redirect=1#wechat_redirect")}else{location.replace("https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx3827070276e49e30&redirect_uri=http://wx.17u.cn/wxflighttest/index.html&response_type=code&scope=snsapi_base&state=123&connect_redirect=1#wechat_redirect")}});function q(){$.ajax({url:"GetNoticeInfoNew",type:"GET",data:{code:100,platId:4},dataType:"json",timeout:3000,success:function(s){if(s.Status){$(".f-tip").show().find("span").html(s.Title);s.Link&&$(".f-tip").parent("a").attr("href",s.Link)}},complete:function(s,t){if(t=="timeout"){s.abort()}}})}function j(){var s="";if(location.href.indexOf("wx.17u.cn/train/")!=-1){s="/web/wxhome/WeChatHome/GetTxAdvertise?pageCode=2&siteCode=2"}else{s="/web/wxhometest/WeChatHome/GetTxAdvertise?pageCode=2&siteCode=2"}$.ajax({url:s,type:"GET",dataType:"JSON",timeout:20000,success:function(t){t=JSON.parse(t);if(t.AdvertiseInfoList.length>0){e(t.AdvertiseInfoList);$(".slideBox").slider({content:".slideCont",item:".slideItem",loop:true,fn:function(){var v=this.index;$(".slidePoint2 span").removeClass("active");$(".slidePoint2 span").eq(v).addClass("active")}});var u=$(".slidePoint2").width();$(".slidePoint2").css("margin-left",-u/2+"px")}}})}function e(u){var s="";var v="";var w="";for(var t=0;t<u.length;t++){s+='<li class="slideItem"><a href="'+u[t].SkipUrl+"\" onclick=\"_tcTraObj._tcTrackEvent('click','guanggaotu"+t+1+"','wxhome','')\"><img src=\""+u[t].ImageUrl+'" alt="" /></a></li>';if(t==0){v+='<span class="active"></span>'}else{v+="<span></span>"}}if(u.length>1){w='<div class="slidePoint2">'+v+"</div>"}var x='<div id="ad" class="slideBox"><div class="slideMain"><ul class="slideCont">'+s+"</ul>"+w+"</div></div>";$("body").prepend(x)}n();o();p();q();j();return}})();function GetDateStr(a){var c=(typeof SERVERTIME!=="undefined")?new Date(SERVERTIME):new Date();c.setDate(c.getDate()+a);var f=c.getFullYear();var e=(c.getMonth()+1)<10?"0"+(c.getMonth()+1):(c.getMonth()+1);var b=c.getDate()<10?"0"+c.getDate():c.getDate();return f+"-"+e+"-"+b}function dateDiff(h,f){var d=h.split("-");var g=isLeap(d[0]);var j=[["1","3","5","7","8","10"],["4","6","9","11"]];if(f=="1"){if((checkArray(d[1],j[0])&&(d[2]=="31"))||(checkArray(d[1],j[1])&&(d[2]=="30"))||(d[1]=="2"&&d[2]=="28"&&!g)||(d[1]=="2"&&d[2]=="29"&&g)){return d[0]+"-"+(d[1]*1+1)+"-"+1}else{if(d[1]=="12"&&d[2]=="31"){return(d[0]*1+1)+"-1-1"}else{d[1]=d[1]*1<10?"0"+d[1]:d[1];d[2]=d[2]*1+1<10?"0"+d[2]*1+1:d[2]*1+1;return d[0]+"-"+d[1]+"-"+d[2]}}}else{if(f=="0"){if(checkArray(d[1]-1,j[0])&&(d[2]=="1")){return d[0]+"-"+(d[1]-1)+"-31"}else{if(checkArray(d[1]-1,j[1])&&(d[2]=="1")){return d[0]+"-"+(d[1]-1)+"-30"}else{if(d[1]=="1"&&d[2]=="1"){return(d[0]-1)+"-12-31"}else{if(d[1]=="3"&&d[2]=="1"&&!g){return d[0]+"-2-28"}else{if(d[1]=="3"&&d[2]=="1"&&g){return d[0]+"-2-29"}else{return d[0]+"-"+d[1]+"-"+(d[2]-1)}}}}}}else{return}}}function isLeap(b){return((b%4==0&&b%100!=0)||b%400==0)?true:false}function checkArray(h,a){for(var f=0,g=a.length;f<g;f++){if(a[f]==h){return true}}return false}function getTimes(k,j){var b=k.split("-");var p=b[0],g=b[1]-1,c=b[2];var e=new Date(p,g,c);var n=new Array("周日","周一","周二","周三","周四","周五","周六");var l=n[e.getDay()];if(j==1){var b=(typeof SERVERTIME!=="undefined")?new Date(SERVERTIME):new Date();var o=b.getFullYear();var f=b.getMonth()+1;var a=b.getDate();f=f<10?"0"+f:f;a=a<10?"0"+a:a;var h=o+"-"+f+"-"+a;if(getTimeDiff(h,k)==0){l="今天"}if(getTimeDiff(h,k)==1){l="明天"}if(getTimeDiff(h,k)==2){l="后天"}}return l}function getTimeDiff(h,a){var c=h.split("-");var f=a.split("-");var d=new Date(c[0],Number(c[1])-1,c[2]);var e=new Date(f[0],Number(f[1])-1,f[2]);var j=parseInt(Math.abs(e-d)/1000/60/60/24);return j}var PolicyDateValidate={presellStratDate:new Date(2014,11,1),presellChangeEndDate:new Date(2014,11,6),presellDepStartDate:new Date(2014,11,30),presellAdvanceDays:60,getcurrentServerTime:function(){return(typeof SERVERTIME!=="undefined")?new Date(SERVERTIME):new Date()},getPolicyDepDate:function(e){var a=this,d=e||this.getcurrentServerTime(),c=new Date(d.getFullYear(),d.getMonth(),d.getDate()),b=d>=this.presellStratDate;var g=function(){if(c<a.presellStratDate){return null}else{if(c>=a.presellStratDate&&c<=a.presellChangeEndDate){var h=c.getDate()-a.presellStratDate.getDate();return new Date(a.presellDepStartDate.getTime()+h*7*24*60*60*1000)}else{return new Date(c.getTime()+(a.presellAdvanceDays-1)*24*60*60*1000)}}};var f=g();if(b==false||f==null){return null}else{return f}}};
});