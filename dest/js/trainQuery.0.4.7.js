define("trainQuery",function(c,a,b){return define("trainQuery.0.4.7",function(e,t,a){function n(e){var t="undefined"!=typeof SERVERTIME?new Date(SERVERTIME):new Date;t.setDate(t.getDate()+e);var a=t.getFullYear(),i=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,n=t.getDate()<10?"0"+t.getDate():t.getDate();return a+"-"+i+"-"+n}function r(e,t){var a=e.split("-"),i=a[0],n=a[1]-1,r=a[2],l=new Date(i,n,r),s=new Array("周日","周一","周二","周三","周四","周五","周六"),c=s[l.getDay()];if(1==t){var a="undefined"!=typeof SERVERTIME?new Date(SERVERTIME):new Date,p=a.getFullYear(),d=a.getMonth()+1,u=a.getDate();d=10>d?"0"+d:d,u=10>u?"0"+u:u;var y=p+"-"+d+"-"+u;0==o(y,e)&&(c="今天"),1==o(y,e)&&(c="明天"),2==o(y,e)&&(c="后天")}return c}function o(e,t){var a=e.split("-"),i=t.split("-"),n=new Date(a[0],Number(a[1])-1,a[2]),r=new Date(i[0],Number(i[1])-1,i[2]),o=parseInt(Math.abs(r-n)/1e3/60/60/24);return o}!function(){function e(){window.page&&"undefined"!=typeof WebConfigUrl&&$.city&&$.calendar&&"undefined"!=typeof mobileUtil&&"undefined"!=typeof StorageHelp?t():setTimeout(e,500)}function t(){function e(e){$.ajax({url:"GetServiceTime",dataType:"json",timeout:5e3,success:function(e){e.ResponseStatus&&(SERVERTIME=e.ResponseMessage.replace(/-/g,"/"))},complete:function(){e&&e()}})}function t(){var e=["A","B","C","D","E","F","G","H","J","K","L","M","N","O","P","Q","R","S","T","W","X","Y","Z"];$.city({nameAttr:1,pyAttr:3,matchAttrs:[1,3],dataAttrMap:{id:0,name:1,fullPy:2},cities:{url:"GetCityListByLetter?allCity=0&letter={cityKey}",dataType:"json",success:function(e){var t=[],a=e.TrainStation.StationList;for(i in a){var n=[];n[0]=a[i].ID,n[1]=a[i].Name,n[2]=a[i].QPY,n[3]=a[i].JPY,t.push(n)}return t}},cityFilter:function(e){return"0"===e[2]},hotCities:{url:"GetHotCityListV1",dataType:"json",success:function(e){var t=[],a=e.TrainStation.StationList;for(i in a){var n=[];n[0]=a[i].ID,n[1]=a[i].Name,n[2]=a[i].QPY,n[3]=a[i].JPY,t.push(n)}return t}},historyCityName:"traincityHistoryName",historyCityNumber:6,fn:function(e){$("#cityPage").toggle(),page.close(),$("p.t_incity input",f).val(e[1]),$(".CN",f).val(e[1]),$(".PY",f).val(e[2])},mode:"asRequired",searchObj:{url:"GetCityListByLetter?allCity=0",name:"letter",dataType:"json",processFn:function(e){if(e.TrainStation){document.querySelector(".search-complete").style.display="block",document.querySelector(".city-wrapper").style.display="none";var t=[],a=e.TrainStation.StationList;for(i in a){var n=[];n[0]=a[i].Name,n[1]=a[i].Name,n[2]=a[i].QPY,n[3]=a[i].JPY,t.push(n)}return t}document.querySelector(".search-complete").style.display="none",document.querySelector(".city-wrapper").style.display="block"}},letters:e,loc:{url:"GetCityListByLetter?allCity=0&letter={cityName}",dataType:"json",success:function(e){var t=[],a=e.TrainStation.StationList,i=[];return i[0]=a[0].ID,i[1]=a[0].Name,i[2]=a[0].QPY,i[3]=a[0].JPY,t.push(i),t}},hasLocation:2})}function a(){var e,t=StorageHelp.GetStorage("City");t&&(e=JSON.parse(t),$("#t_from .t_incity input").val(e.bName),$("#t_from .CN").val(e.bName),$("#t_from .PY").val(e.beginCity),$("#t_to .t_incity input").val(e.aName),$("#t_to .CN").val(e.aName),$("#t_to .PY").val(e.arrCity))}function o(){e(function(){var e,t,a,i=new Date("undefined"!=typeof SERVERTIME?new Date(SERVERTIME):new Date),o=(i.getFullYear(),i.getMonth()+1),l=i.getDate();o=10>o?"0"+o:o,l=10>l?"0"+l:l;var s=i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate(),c=StorageHelp.GetStorage("bDate"),p=c&&Date.parse(c.replace(/-/g,"/"))>=Date.parse(s.replace(/-/g,"/"))?c:n(1),d=r(p.replace(/-0/g,"-"),1),u="";d.indexOf("周")<0&&(u="&nbsp;&nbsp;"+d);var y=p.split("-");e=y[0],t=y[1],a=y[2],$("div#BeginTime input[type=hidden]").val(p),$("#tselect_Date").html(\'<span class="orange">\'+t+"月"+a+"日</span><span>"+u+"&nbsp;&nbsp;"+r(p.replace(/-0/g,"-"),0))})}function s(){var e=StorageHelp.GetStorage("queryhistory"),t="";if(""!=e&&JSON.parse(e).length>0){var a=JSON.parse(e);a.length>5&&(a.length=5);for(var i=0,n=a.length;n>i;i++)t+="<li class=\'touchablelist\' onclick=\\"_tcTraObj._tcTrackEvent(\'click\',\'chaxunlishi\',\'wxtrain\',\'\')\\"><span py="+a[i].beginCity+">"+a[i].bName+"</span>至<span py="+a[i].arrCity+">"+a[i].aName+"</span></li>"}""==t&&$(".linebox").addClass("none"),$("#queryhistory .querybox_cont ul").html(t),$(".querybox_cont li").on("touchstart",function(){var e=this;timer=setTimeout(function(){var t=$.dialog({autoOpen:!1,closeBtn:!1,width:200,closeTime:1e3,maskClick:function(){t.destroy()},content:\'<button class="del touchable">删除</button>\'});t.open(),$(".ui-dialog-content").css({padding:0}),$(".ui-dialog .del").on("click",function(){$(e).remove(),t.destroy();var a={};a.beginCity=$("span",e).eq(0).attr("py"),a.arrCity=$("span",e).eq(1).attr("py"),a.bName=$("span",e).eq(0).html(),a.aName=$("span",e).eq(1);var i=JSON.parse(StorageHelp.GetStorage("queryhistory"));i.shift(a),StorageHelp.SetStorage("queryhistory",JSON.stringify(i))})},500)}).on("touchmove",function(){clearTimeout(timer)}).on("click",function(){if(null==$(".ui-mask").html()){var e=$("span",this).eq(0),t=$("span",this).eq(1);$("#t_goCity").val(e.html()),$("[name=\'BeginPlaceCn\']").val(e.html()),$("[name=\'BeginPlace\']").val(e.attr("py")),$("#t_backCity").val(t.html()),$("[name=\'ArrPlaceCn\']").val(t.html()),$("[name=\'ArrPlace\']").val(t.attr("py"))}}).on("touchend",function(){clearTimeout(timer)});var r=$(window).height()-450;$(".querybox_cont").height(r>24?r:24)}function c(){var e=$("input#t_goCity").val(),t=$("input#t_backCity").val(),a=$("#t_from .PY").val(),i=$("#t_to .PY").val();$("#t_backCity").addClass("flyleft"),$("#t_goCity").addClass("flyright"),setTimeout(function(){$("#t_backCity").removeClass("flyleft"),$("#t_goCity").removeClass("flyright"),$("input#t_goCity").val(t),$("#t_backCity").val(e),$("#t_from .PY").val(i),$("#t_from .CN").val(t),$("#t_to .PY").val(a),$("#t_to .CN").val(e)},500)}function p(){$.ajax({url:"GetNoticeInfoNew",type:"GET",data:{code:100,platId:4},dataType:"json",timeout:3e3,success:function(e){e.Status&&($(".f-tip").show().find("span").html(e.Title),e.Link&&$(".f-tip").parent("a").attr("href",e.Link))},complete:function(e,t){"timeout"==t&&e.abort()}})}function d(){var e="";e=-1!=location.href.indexOf("wx.17u.cn/train/")?"/web/wxhome/WeChatHome/GetTxAdvertise?pageCode=2&siteCode=2":"/web/wxhometest/WeChatHome/GetTxAdvertise?pageCode=2&siteCode=2",$.ajax({url:e,type:"GET",dataType:"JSON",timeout:2e4,success:function(e){if(e=JSON.parse(e),e.AdvertiseInfoList.length>0){u(e.AdvertiseInfoList),$(".slideBox").slider({content:".slideCont",item:".slideItem",loop:!0,fn:function(){var e=this.index;$(".slidePoint2 span").removeClass("active"),$(".slidePoint2 span").eq(e).addClass("active")}});var t=$(".slidePoint2").width();$(".slidePoint2").css("margin-left",-t/2+"px")}}})}function u(e){for(var t="",a="",i="",n=0;n<e.length;n++)t+=\'<li class="slideItem"><a href="\'+e[n].SkipUrl+"\\" onclick=\\"_tcTraObj._tcTrackEvent(\'click\',\'guanggaotu"+n+"1\',\'wxhome\',\'\')\\"><img src=\\""+e[n].ImageUrl+\'" alt="" /></a></li>\',a+=0==n?\'<span class="active"></span>\':"<span></span>";e.length>1&&(i=\'<div class="slidePoint2">\'+a+"</div>");var r=\'<div id="ad" class="slideBox"><div class="slideMain"><ul class="slideCont">\'+t+"</ul>"+i+"</div></div>";$("body").prepend(r)}var y=$("<div id=\'calContainerPage\' class=\'page\'/>");$("body").append(y),page&&page.init(function(e){return/^[\\w-]*$/.test(e)?$("#"+e+"Page"):[]});var f;$("#t_from,#t_to").on("click",function(){page.open("city"),$("#cityPage input").attr("onkeydown","if(event.keyCode==32) return false;"),t(),f=this});var g=["元宵","清明","端午","中秋","重阳","情人","儿童","国庆","圣诞"];$("#BeginTime").click(function(){$("#calContainerPage").find(".calendar").remove();var e=$.calendar({mode:"rangeFrom",startDate:"undefined"!=typeof SERVERTIME?new Date(SERVERTIME):new Date,endDate:l.getPolicyDepDate()||new Date(Date.parse("undefined"!=typeof SERVERTIME?new Date(SERVERTIME):new Date)+16416e5),wrapper:$("#calContainerPage"),currentDate:[$("#Time").val()],fn:function(e){var t=e.join("-");e=new Date(e.join("/")),StorageHelp.SetStorage("bDate",e.format("yyyy-MM-dd")),$("#Time").val(e.format("yyyy-MM-dd"));var a=r(t.replace(/-0/g,"-"),1),i="";a.indexOf("周")<0&&(i="&nbsp;&nbsp;"+a),$("#tselect_Date").html(\'<span class="orange">\'+(e.getMonth()+1)+"月"+e.getDate()+"日</span>&nbsp;<span>&nbsp;"+r(t.replace(/-0/g,"-"),1)+\'</span><span class="tra_left wxTrainBg"></span>\'),page.close()},buildContent:function(e,t,a,i){var n,r="undefined"!=typeof SERVERTIME?new Date(SERVERTIME):new Date,o="undefined"!=typeof SERVERTIME?new Date(SERVERTIME):new Date,l=new Date(r.setDate(r.getDate()+1)),s=new Date(r.setDate(l.getDate()+1));return n=t?t:e.getDate(),t&&(n=-1!==g.indexOf(t)?"<div>"+t+"节</div>":"<div>"+t+"</div>"),e.format("yyyyMMdd")==l.format("yyyyMMdd")&&(n="明天"),e.format("yyyyMMdd")==s.format("yyyyMMdd")&&(n="后天"),a.toString().indexOf("today")>=0&&(n=e.getDate()),e.format("yyyyMMdd")==o.format("yyyyMMdd")&&(n="<div class=\'today\'>今天</div>"),new Date(e.format("yyyy/MM/dd"))>new Date(this.endDate.format("yyyy/MM/dd"))&&a.push("area"),n}});$("#calContainerPage .tip").remove();var t=e.startDate.getMonth()+1,a=e.startDate.getDate(),i=e.endDate.getMonth()+1,n=e.endDate.getDate();$("#calContainerPage").append(\'<div class="tip"><p>今天是\'+t+"月"+a+"号，可购买"+i+"月"+n+"号的火车票</p><p>部分车次预售期特殊，请以车站当日公布的为准</p></div>"),$("#calContainerPage .area.disabled[data-day]").on("click",function(){var e=$(this).parents(".calendar-wrapper"),t=e.attr("data-year")+"/"+e.attr("data-month")+"/"+$(this).attr("data-day"),a=new Date(new Date(t).setDate(new Date(t).getDate()-59)).format("yyyy年MM月dd日");mobileUtil.dialog("预售期为60天，您所选日期将在"+a+"开售。","#calContainerPage")}),page.open("calContainer")}),$("#t_changeCity").on(mobileUtil.start,function(){c()}),$("#myTrainOrders").click(function(){unLogin()&&(location.href=WebConfigUrl.MyOrders)}),$("#SpecialZone").bind("click",function(){var e=getWxObj().userid;if(""!=e&&"0"!=e&&""!=e)location.href="/flight/flightspecialindex.html?bookerId="+e;else{var t=getWxObj().openid;!t||/undefined/.test(t)&&""==t||(t="123"),location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx3827070276e49e30&redirect_uri=http://wx.17u.cn/flight/flightspecialindex.html?showwxpaytitle=1&response_type=code&scope=snsapi_base&state="+t+"#wechat_redirect"}}),$("#myhelper2").bind("click",function(){location.href="/flight/myflighthelper.html";var e=getWxObj().userid;if(""!=e&&"0"!=e&&"undefined"!=typeof e)location.href="/flight/myflighthelper.html?bookerId="+e;else{var t=getWxObj().openid;!t||/undefined/.test(t)&&""==t||(t="123"),location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx3827070276e49e30&redirect_uri=http://wx.17u.cn/flight/myflighthelper.html?showwxpaytitle=1&response_type=code&scope=snsapi_base&state="+t+"#wechat_redirect"}}),$("#index").bind("click",function(){location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx3827070276e49e30&redirect_uri=http://wx.17u.cn/train/trainquery.html?showwxpaytitle=1&response_type=code&scope=snsapi_base&state=123#wechat_redirect"}),$("#myflight").bind("click",function(){location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx3827070276e49e30&redirect_uri=http://wx.17u.cn/flight/myflight.html?showwxpaytitle=1&response_type=code&scope=snsapi_base&state=123#wechat_redirect"}),$("form#t_myform").submit(function(){var e=$("#t_from .PY").val().trim(),t=$("#t_to .PY").val().trim(),a=getWxObj().openid||getCooperateUser().openid,i=getWxObj().token||getCooperateUser().token,n=$("#t_goCity").val().trim(),r=$("#t_backCity").val().trim(),o=$("div#BeginTime input[type=hidden]").val().trim(),l=$(this).attr("aurl");if($("input[type=hidden][name=\'openid\']").val(a),$("input[type=hidden][name=\'token\']").val(i),""==e||""==n)return mobileUtil.dialog("请选择出发城市！","#mainPage"),!1;if(""==t||""==r)return mobileUtil.dialog("请选择到达城市！","#mainPage"),!1;if(""==o)return mobileUtil.dialog("请选择出发日期！","#mainPage"),!1;if(e==t)return mobileUtil.dialog("出发站点不能和到达站点相同！","#mainPage"),!1;var s={beginCity:e,arrCity:t,bName:n,aName:r};StorageHelp.SetStorage("City",JSON.stringify(s)),StorageHelp.SetStorage("bDate",o),StorageHelp.SetStorage("filter",""),l=l.replace("{begincity}",e).replace("{tocity}",t).replace("{time}",o.replace(/-/g,"")).replace("{openid}",a).replace("{token}",i);var c=StorageHelp.GetStorage("queryhistory");""==c&&(c="[]");var p=JSON.parse(c);p.forEach(function(e,t){e.beginCity==s.beginCity&&e.arrCity==s.arrCity&&p.splice(t,1)}),p.unshift(s),c=JSON.stringify(p),StorageHelp.SetStorage("queryhistory",c),this.action=WebConfigUrl.wxTrainUrl+"trainsearch.html"}),$("#IsFlight").bind("click",function(){$(this).addClass("border_bottom_green"),$("#IsTrain").removeClass("border_bottom_green"),-1!=location.href.indexOf("wx.17u.cn/train/")?location.replace("https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx3827070276e49e30&redirect_uri=http://wx.17u.cn/flight/index.html&response_type=code&scope=snsapi_base&state=123&connect_redirect=1#wechat_redirect"):location.replace("https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx3827070276e49e30&redirect_uri=http://wx.17u.cn/wxflighttest/index.html&response_type=code&scope=snsapi_base&state=123&connect_redirect=1#wechat_redirect")}),a(),o(),s(),p(),d()}"undefined"!=typeof Common&&(Common.initMenu("#footer"),Common.initEntry("submain")),setTimeout(function(){var e=getWxObj().openid,t=getWxObj().userid;e&&"null"!=e&&"0"!=e&&void 0!=e&&"undefined"!=e&&StorageHelp.SetStorage("WxOpenid",e),t&&"null"!=t&&void 0!=t&&"undefined"!=t&&"0"!=t&&""!=t?StorageHelp.SetStorage("WxUserid",t):StorageHelp.SetStorage("WxUserid","")},2e3),e()}();var l={presellStratDate:new Date(2014,11,1),presellChangeEndDate:new Date(2014,11,6),presellDepStartDate:new Date(2014,11,30),presellAdvanceDays:60,getcurrentServerTime:function(){return"undefined"!=typeof SERVERTIME?new Date(SERVERTIME):new Date},getPolicyDepDate:function(e){var t=this,a=e||this.getcurrentServerTime(),i=new Date(a.getFullYear(),a.getMonth(),a.getDate()),n=a>=this.presellStratDate,r=function(){if(i<t.presellStratDate)return null;if(i>=t.presellStratDate&&i<=t.presellChangeEndDate){var e=i.getDate()-t.presellStratDate.getDate();return new Date(t.presellDepStartDate.getTime()+7*e*24*60*60*1e3)}return new Date(i.getTime()+24*(t.presellAdvanceDays-1)*60*60*1e3)},o=r();return 0==n||null==o?null:o}}});},'m');