define("city",function(c,a,b){return define("city",function(t,e,i){!function(){function t(t){return $.extend(this,{name:"city",hasSearch:!0,placeholder:"中文/拼音/首字母",hasLocation:1,nameAttr:"name",pyAttr:"fullPy",dataAttrMap:{id:"id",name:"name"},matchAttrs:["name","fullPy","shortPy"],historyCityName:"historyCities",cityFilter:function(){return!0},hotCityFilter:function(t,e){return t===e[this.nameAttr]},historyCityNumber:5},t),a.call(this),"asRequired"===this.mode?void($.isArray(this.hotCities)?l.call(this):e.call(this,l)):($.isArray(this.hotCities)?this.hotCitiesReady=!0:e.call(this,c),void($.isArray(this.cities)?(this.citiesReady=!0,c.call(this)):i.call(this,c)))}function e(t){var e=this,i=$.extend({},e.hotCities);i.success=function(i){e.hotCities.success&&(i=e.hotCities.success(i)),e.hotCities=i,e.hotCitiesReady=!0,t.call(e)},$.ajax(i)}function i(t,e){var i=this,s=$.extend({},i.cities);e&&(s.url=s.url.replace("{cityKey}",e.attr("data-city-key"))),s.success=function(s){i.cities.success&&(s=i.cities.success(s)),e?t.call(i,s,e):(i.cities=s,i.citiesReady=!0,t.call(i))},$.ajax(s)}function s(t,e){for(var i="",s=0,a=t.length;a>s;s++)i+=this.buildCityItem(t[s],"li");e.next().html(i)}function a(){this.elem?this.elem=$(this.elem):(this.elem=$(\'<div id="cityPage" class="page"></div>\'),this.elem.appendTo($("body")));var t="";this.hasSearch&&(t+=\'<div class="search search-reset"><input placeholder="\'+this.placeholder+\'" /><span class="search-icon"></span><span class="clear"><i>×</i></span><span class="cancel">取消</span></div><div class="search-complete"></div>\'),t+=\'<div class="city-wrapper"></div>\',this.elem.append(t)}function l(){if(this.hotCitiesReady){var t="";this.hasLocation&&(t+=\'<h3 class="city-key-dw">定位</h3><ul class="dw-city">\'+(1===this.hasLocation?\'<li class="disabled">正在获取位置信息\':\'<li class="disabled get-location">点击获取当前位置\')+"</li></ul>");for(var e=this.hotCities,a=[],l=0,c=e.length;c>l;l++)a.push(this.buildCityItem(e[l],"li"));t+=\'<h3 class="city-key-rm">热门</h3><ul>\'+a.join("")+"</ul>",this.letters||(this.letters=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"]);var r,o=this.letters;for(l=0,c=o.length;c>l;l++)r=o[l],t+=\'<h3 class="city-key" data-city-key="\'+r+\'">\'+r+"</h3><ul></ul>";$(".city-wrapper",this.elem).html(t),1===this.hasLocation&&h.call(this);var u=this;$(".city-wrapper",this.elem).delegate(".city-key","click",function(){var t=$(this);if(t.hasClass("open"))return void t.removeClass("open").next().addClass("closed");$(".open",t.liveFired).removeClass("open").next().addClass("closed"),t.addClass("open");var e=t.next();return e.hasClass("closed")?void e.removeClass("closed"):void i.call(u,s,t)}),n.call(this)}}function c(){if(this.hotCitiesReady&&this.citiesReady){var t,e,i,s=this.cities,a=[];this.completeData=[];for(var l=0,c=s.length;c>l;l++)t=s[l],this.cityFilter(t)&&(this.completeData.push(r.call(this,t)),e=t[this.pyAttr].toUpperCase().charCodeAt(0)-65,i=a[e],void 0===i&&(i=a[e]=[]),i.push(this.buildCityItem(t,"li")),this.getHotCity(t));i="";var o=[];this.hasLocation&&(i+=\'<h3 class="city-key-dw">定位</h3><ul class="dw-city">\'+(1===this.hasLocation?\'<li class="disabled">正在获取位置信息\':\'<li class="disabled get-location">点击获取当前位置\')+"</li></ul>",o.push(\'<li data-key="dw">定位</li>\'));var u=[];for(s=this.hotCities,l=0,c=s.length;c>l;l++)t=s[l],u.push(this.buildCityItem(t,"li"));i+=\'<h3 class="city-key-rm">热门</h3><ul>\'+u.join("")+"</ul>",o.push(\'<li data-key="rm">热门</li>\');var d;for(l=65;91>l;l++)a[l-65]&&(d=String.fromCharCode(l),o.push(\'<li data-key="\'+d+\'">\'+d+"</li>"),i+=\'<h3 class="city-key-\'+d+\'">\'+d+"</h3><ul>"+a[l-65].join("")+"</ul>");$(".city-wrapper",this.elem).html(i),$(this.elem).append(\'<ul class="city-nav">\'+o.join("")+"</ul>"),1===this.hasLocation&&h.call(this),n.call(this)}}function r(t){for(var e=$.extend({match:[]},t),i=0,s=this.matchAttrs.length;s>i;i++)e.match.push(t[this.matchAttrs[i]]);return e}function h(){function t(t){if(t.tips)e.html(\'<li class="disabled\'+(t.reject?"":" retry")+\'">\'+t.tips+(t.reject?"":"(点击重试)")+"</li>");else{var s=t.city.replace("市","");if("[object Object]"===Object.prototype.toString.call(i.cities)&&i.loc)ajaxObj=$.extend({},i.loc),ajaxObj.url=ajaxObj.url.replace("{cityName}",s),ajaxObj.url=ajaxObj.url.replace("{latitude}",t.latitude),ajaxObj.url=ajaxObj.url.replace("{longitude}",t.longitude),ajaxObj.success=function(t){i.loc.success&&(t=i.loc.success(t)),e.html("");for(var s in t)e.append(i.buildCityItem(t[s],"li"))},$.ajax(ajaxObj);else{for(var a=0,l=i.cities.length;l>a;a++)if(i.cities[a][i.nameAttr]===s){e.html(i.buildCityItem(i.cities[a],"li"));break}a===i.cities.length&&(e=$(".dw-city",this.elem).html(\'<li class="disabled">定位到的城市(\'+s+")不符合要求</li>"))}}}var e=$(".dw-city",this.elem).html(\'<li class="disabled">正在获取位置信息</li>\'),i=this;$.location.gpsInfo?t($.location.gpsInfo):$.location(t)}function n(){var t=this,e=$(".search input",this.elem);$(".city-nav",t.elem).delegate("li","click",function(){window.scrollTo(0,$(".city-key-"+this.getAttribute("data-key"),t.elem).offset().top)}),$(".city-wrapper",this.elem).delegate("li","click ",function(){var e=$(this);e.hasClass("disabled")?(e.hasClass("get-location")||e.hasClass("retry"))&&h.call(t):u.call(t,this)}),this.hasSearch&&($(".search-complete",this.elem).on("click",function(){""===e[0].value&&setTimeout(function(){m.call(t)},300)}),e.on("focus",function(){t.autoComplete&&""===this.value&&(t.autoComplete.resetDefaultData(d.call(t)),t.autoComplete.show()),$(".search",this.elem).removeClass("search-reset"),$(".city-wrapper, .city-nav",this.elem).css({display:"none"}),$(".search-complete",this.elem).css({display:"block"})}).val("").trigger("keyup"),$(".clear",t.elem).on("click",function(){""!==e.val()&&(e.val(""),t.autoComplete.show())}),$(".cancel",t.elem).on("click",function(){e.val(""),m.call(t)}),p.call(this))}function o(t){var e="number"==typeof this.nameAttr?[]:{};for(var i in this.dataAttrMap)e[this.dataAttrMap[i]]=t.getAttribute("data-"+i);return e[this.nameAttr]||(e[this.nameAttr]=t.innerHTML),e}function u(t){var e=this,i=o.call(this,t);y.call(this,i),setTimeout(function(){m.call(e)},300),this.fn&&this.fn(i)}function d(){var t=localStorage.getItem(this.historyCityName);return t=t?JSON.parse(t):[]}function y(t){var e="";try{e=localStorage.getItem(this.historyCityName)}catch(i){}e=e?JSON.parse(e):[];for(var s=0,a=e.length;a>s;s++)if(e[s][this.nameAttr]===t[this.nameAttr]){e.splice(s,1);break}e.unshift(t),e.length>this.historyCityNumber&&e.splice(this.historyCityNumber,e.length-this.historyCityNumber);try{localStorage.setItem(this.historyCityName,JSON.stringify(e))}catch(i){}}function p(){var t=this,e={name:"value",type:"GET",url:"",dataType:"json",processFn:function(t){return t}};t.searchObj&&$.extend(e,t.searchObj),t.autoComplete=$(".search input",t.elem).autoComplete({content:$(".search-complete",t.elem),localData:t.completeData,defaultData:d.call(t),max:10,title:!1,needClose:!1,requestUrl:e.url,dataType:e.dataType,type:e.type,requestValName:e.name,processAjaxDataFn:e.processFn,itemValueFn:function(){return""},itemPrintFn:function(e){return t.buildCityItem(e,"div")},keepListOnNoResult:!1,showClosebtn:!1,selectItemFn:function(e,i){u.call(t,$("div",i)[0])},chooseClass:""})}function m(){$(".search-complete .autofill-wrap",this.elem).css({display:"none"}),$(".search",this.elem).addClass("search-reset"),$(".city-wrapper, .city-nav",this.elem).css({display:"block"}),$(".search-complete",this.elem).css({display:"none"})}$.city=function(e){if(e.elem){if($(".city-wrapper",e.elem).length)return}else if($("#"+(e.id||"city")+"Page .city-wrapper").length)return;new t(e)},t.prototype.buildCityItem=function(t,e){var i="<"+e;for(var s in this.dataAttrMap)i+=" data-"+s+\'="\'+t[this.dataAttrMap[s]]+\'"\';return i+=">"+t[this.nameAttr]+"</"+e+">"},t.prototype.getHotCity=function(t){if(this.hotCityFilter)for(var e=this.hotCities,i=0,s=e.length;s>i;i++)if(this.hotCityFilter(e[i],t)){e[i]=t;break}}}()});},'m');